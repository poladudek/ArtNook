openapi: 3.0.0
info:
  title: ArtNook API
  version: 1.0.0
  description: Full API specification for the ArtNook cinema project (users, movies, screenings, bookings)
servers:
  - url: http://localhost:3000
paths:
  /api/register:
    post:
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegister'
      responses:
        '200':
          description: Registration result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/login:
    post:
      summary: Login user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLogin'
      responses:
        '200':
          description: Login result with JWT token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/me:
    get:
      summary: Get current user
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Current authenticated user info
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean }
                  user:
                    type: object
                    properties:
                      id: { type: integer }
                      email: { type: string }
                      role: { type: string }
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/movies:
    get:
      summary: List movies (paginated)
      parameters:
        - in: query
          name: page
          schema: { type: integer }
        - in: query
          name: per_page
          schema: { type: integer }
      responses:
        '200':
          description: A paginated list of movies
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedMovies'
    post:
      summary: Create a movie (admin)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateMovie'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean }
                  id: { type: integer }
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
  /api/movies/{id}:
    delete:
      summary: Delete a movie (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Deletion result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'
        '401':
          description: Unauthorized
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/screenings:
    get:
      summary: List screenings (paginated)
      parameters:
        - in: query
          name: page
          schema: { type: integer }
        - in: query
          name: per_page
          schema: { type: integer }
      responses:
        '200':
          description: Paginated list of screenings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedScreenings'
    post:
      summary: Create a screening
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateScreening'
      responses:
        '201':
          description: Screening created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/screenings/{id}:
    get:
      summary: Get screening by id
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Screening object
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScreeningDetail'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    put:
      summary: Update screening
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Update confirmation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'
    delete:
      summary: Delete screening
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Deletion confirmation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'

  /api/screenings/full/{movieId}:
    get:
      summary: Get full screening info by movie id (list of screenings for a movie)
      parameters:
        - in: path
          name: movieId
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Array of screening objects for given movie id
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ScreeningShort'

  /api/screenings/reserve/{id}/{seat_num}:
    post:
      summary: Reserve a seat (requires auth)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
        - in: path
          name: seat_num
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Reservation successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'
        '401':
          description: Unauthorized
        '409':
          description: Seat already reserved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/bookings:
    post:
      summary: Create a booking (user must be authenticated)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                screening_id: { type: integer }
                seat_number: { type: string }
      responses:
        '201':
          description: Booking created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean }
                  booking_id: { type: integer }
        '409':
          description: Seat already taken
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/bookings/mine:
    get:
      summary: Get current user's bookings
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Array of bookings for current user
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Booking'
  /api/bookings/{id}:
    delete:
      summary: Cancel booking
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Cancelled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'
        '404':
          description: Not found or not owned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    UserRegister:
      type: object
      required: [first_name, last_name, email, password]
      properties:
        first_name: { type: string }
        last_name: { type: string }
        email: { type: string, format: email }
        password: { type: string, minLength: 7 }
    UserLogin:
      type: object
      required: [email, password]
      properties:
        email: { type: string, format: email }
        password: { type: string }
    LoginResponse:
      type: object
      properties:
        success: { type: boolean }
        token: { type: string }
        user:
          type: object
          properties:
            email: { type: string }
            role: { type: string }
    SuccessMessage:
      type: object
      properties:
        success: { type: boolean }
        message: { type: string }
    ErrorResponse:
      type: object
      properties:
        success: { type: boolean }
        message: { type: string }
    Movie:
      type: object
      properties:
        id: { type: integer }
        title: { type: string }
        description: { type: string }
        duration: { type: integer }
        img_path: { type: string }
    CreateMovie:
      type: object
      required: [title, description, duration]
      properties:
        title: { type: string }
        description: { type: string }
        duration: { type: integer }
        img_path: { type: string }
    PaginatedMovies:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Movie'
        meta:
          type: object
          properties:
            total: { type: integer }
            page: { type: integer }
            per_page: { type: integer }
            total_pages: { type: integer }
    ScreeningShort:
      type: object
      properties:
        id: { type: integer }
        start_time: { type: string, format: date-time }
        end_time: { type: string, format: date-time }
        room_name: { type: string }
        movie_title: { type: string }
        movie_id: { type: integer }
    ScreeningDetail:
      type: object
      properties:
        id: { type: integer }
        movie_id: { type: integer }
        start_time: { type: string, format: date-time }
        end_time: { type: string, format: date-time }
        room_name: { type: string }
        seats_total: { type: integer }
        seats:
          type: array
          items:
            type: object
            properties:
              seat_number: { type: string }
              is_booked: { type: boolean }
    CreateScreening:
      type: object
      required: [movie_id, start_time]
      properties:
        movie_id: { type: integer }
        room_id: { type: integer }
        room_name: { type: string }
        start_time: { type: string, format: date-time }
    PaginatedScreenings:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/ScreeningShort'
        meta:
          type: object
          properties:
            total: { type: integer }
            page: { type: integer }
            per_page: { type: integer }
            total_pages: { type: integer }
    Booking:
      type: object
      properties:
        id: { type: integer }
        user_id: { type: integer }
        screening_id: { type: integer }
        seat_number: { type: string }
        status: { type: string }
    

